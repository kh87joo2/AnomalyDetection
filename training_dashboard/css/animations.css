.connection-layer {
  overflow: visible;
  pointer-events: none;
}

.connection-line {
  fill: none;
  stroke: rgba(46, 200, 255, 0.92);
  stroke-width: 2;
  stroke-dasharray: 9 5;
  stroke-linecap: round;
  filter: drop-shadow(0 0 7px rgba(46, 200, 255, 0.75));
  animation: dash-flow 0.9s linear infinite;
}

.connection-line.echo {
  stroke: rgba(138, 220, 255, 0.28);
  stroke-width: 5;
  stroke-dasharray: 2 14;
  animation: dash-flow 1.45s linear infinite;
}

.connection-line[data-state="idle"] {
  stroke: rgba(131, 170, 227, 0.62);
  stroke-dasharray: 4 9;
  animation: none;
  filter: none;
}

.connection-line.echo[data-state="idle"] {
  stroke: rgba(117, 151, 212, 0.17);
  animation: none;
}

.connection-line[data-state="running"] {
  stroke: rgba(74, 226, 255, 0.97);
  animation: dash-flow 0.78s linear infinite, line-pulse 1.4s ease-in-out infinite;
}

.connection-line.echo[data-state="running"] {
  stroke: rgba(130, 235, 255, 0.3);
  animation: dash-flow 1.1s linear infinite, line-pulse 1.9s ease-in-out infinite;
}

.connection-line[data-state="done"] {
  stroke: rgba(114, 243, 186, 0.94);
  stroke-dasharray: 7 4;
  animation: dash-flow 1.8s linear infinite, done-glow 2.6s ease-in-out infinite;
}

.connection-line.echo[data-state="done"] {
  stroke: rgba(124, 236, 182, 0.26);
  stroke-dasharray: 3 8;
  animation: dash-flow 2.4s linear infinite;
}

.connection-line[data-state="fail"] {
  stroke: rgba(255, 124, 152, 0.95);
  animation: dash-flow 0.58s linear infinite, fault-blink 1.05s ease-in-out infinite;
}

.connection-line.echo[data-state="fail"] {
  stroke: rgba(255, 135, 161, 0.24);
  animation: dash-flow 0.8s linear infinite, fault-blink 1.2s ease-in-out infinite;
}

.connection-line.is-hidden {
  display: none;
}

.node-card[data-status="running"] {
  animation: node-running 1.4s ease-in-out infinite;
}

.node-card[data-status="done"] {
  animation: node-done 2.6s ease-in-out infinite;
}

.node-card[data-status="fail"] {
  animation: node-fail 1.1s ease-in-out infinite;
}

.node-card[data-status="idle"] {
  animation: none;
}

@keyframes dash-flow {
  to {
    stroke-dashoffset: -24;
  }
}

@keyframes line-pulse {
  0%,
  100% {
    opacity: 0.82;
  }
  50% {
    opacity: 1;
  }
}

@keyframes done-glow {
  0%,
  100% {
    filter: drop-shadow(0 0 6px rgba(114, 243, 186, 0.3));
  }
  50% {
    filter: drop-shadow(0 0 12px rgba(114, 243, 186, 0.55));
  }
}

@keyframes fault-blink {
  0%,
  100% {
    opacity: 1;
  }
  45% {
    opacity: 0.6;
  }
  65% {
    opacity: 0.92;
  }
}

@keyframes node-running {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-1px);
  }
}

@keyframes node-done {
  0%,
  100% {
    box-shadow: 0 0 0 1px rgba(114, 243, 186, 0.48), 0 0 20px rgba(54, 176, 129, 0.26);
  }
  50% {
    box-shadow: 0 0 0 1px rgba(114, 243, 186, 0.66), 0 0 30px rgba(54, 176, 129, 0.4);
  }
}

@keyframes node-fail {
  0%,
  100% {
    box-shadow: 0 0 0 1px rgba(255, 123, 143, 0.54), 0 0 20px rgba(186, 66, 96, 0.25);
  }
  50% {
    box-shadow: 0 0 0 1px rgba(255, 123, 143, 0.74), 0 0 28px rgba(186, 66, 96, 0.42);
  }
}

@media (prefers-reduced-motion: reduce) {
  .connection-line,
  .node-card {
    animation: none !important;
  }
}
